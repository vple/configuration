#!/bin/zsh

# FUTURE:
#   - Programmatically find installs, configurations, etc. instead of doing everything directly.

set -e

### VARS ###

GIT_ROOT=$(git rev-parse --show-toplevel)
VERBOSE=0

### AUTOLOAD ###

fpath=( "$GIT_ROOT/.zsh_functions" "${fpath[@]}" )
autoload -Uz has
autoload -Uz log
autoload -Uz link_file

### OPT PARSING ###

while getopts "v" OPTION
do
  case $OPTION in
    v) VERBOSE=1 ;;
  esac
done

### UTILITY FUNCTIONS ###

### INSTALLATIONS ###

source "$GIT_ROOT/homebrew/install"

brew bundle -q --file "$GIT_ROOT/git/Brewfile"
brew bundle -q --file "$GIT_ROOT/apps/Brewfile"
brew bundle -q --file "$GIT_ROOT/cli/Brewfile"

### CONFIGURATIONS ###

source "$GIT_ROOT/macos/configure"
source "$GIT_ROOT/git/configure"

### UPDATE ###

brew upgrade

log "Done!"
